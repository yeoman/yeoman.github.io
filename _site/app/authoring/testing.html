<p>Read on to learn more about the testing helpers Yeoman add to ease the pain of unit testing a generator.</p>

<p>The examples below assume you uses <a href="http://visionmedia.github.io/mocha/">Mocha</a> in BDD mode. The global concept should apply easily to your unit testing framework of choice.</p>

<h2>Organizing your tests</h2>

<p>It is important to keep your tests simple and easily editable.</p>

<p>Usually the best way to organize your tests is to separate each generator and sub-generator into its own <code>describe</code> block. Then, add a <code>describe</code> block for each option your generator accept. And then, use an <code>it</code> block for each assertion (or related assertion).</p>

<p>The code running the generator should be located in a <code>before</code> or <code>beforeEach</code> block - it usually doesn&#39;t belong with your assertions.</p>

<p>In code, you should end up with a structure similar to this:</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;backbone:app&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;when using require.js&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Mock the options, set up an output folder and run the generator</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;generate a router.js file&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="c1">// assert the file exist</span>
      <span class="c1">// assert the file uses AMD definition</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;generate a view file&#39;</span><span class="p">);</span>
    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;generate a base controller&#39;</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h2>Test helpers</h2>

<p>Yeoman provide test helpers methods. Require them like this:</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="kd">var</span> <span class="nx">helpers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;yeoman-generator&#39;</span><span class="p">).</span><span class="nx">test</span><span class="p">;</span>
</code></pre></div>
<p>You can check <a href="http://yeoman.github.io/generator/helpers.html">the full helpers API here</a>. These methods will usually be run inside a <code>before</code> block.</p>

<p>The most useful method when unit testing a generator is <code>helpers.run()</code>. This method will return a <a href="http://yeoman.github.io/generator/RunContext.html">RunContext</a> instance on which you can call method to setup a directory, mock prompt, mock arguments, etc.</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>

<span class="nx">before</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">helpers</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../app&#39;</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">inDir</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;./tmp&#39;</span><span class="p">))</span>  <span class="c1">// Clear the directory and set it as the CWD</span>
    <span class="p">.</span><span class="nx">withOptions</span><span class="p">({</span> <span class="nx">foo</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span> <span class="p">})</span>            <span class="c1">// Mock options passed in</span>
    <span class="p">.</span><span class="nx">withArguments</span><span class="p">([</span><span class="s1">&#39;name-x&#39;</span><span class="p">])</span>              <span class="c1">// Mock the arguments</span>
    <span class="p">.</span><span class="nx">withPrompt</span><span class="p">({</span> <span class="nx">coffee</span><span class="o">:</span> <span class="kc">false</span> <span class="p">})</span>          <span class="c1">// Mock the prompt answers</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">generator</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// this is called right before `generator.run()` is called</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="nx">done</span><span class="p">);</span>
<span class="p">})</span>
</code></pre></div>
<p>You should always use <code>path.join</code> and <code>__dirname</code> when creating relative path because the Current Working Directory is dependent on where the node command was called.</p>

<p>Sometimes you may want to construct a test scenario for the generator to run with existing contents in the target directory. In which case, you could invoke <code>inDir()</code> with an optional second parameter (a callback function), like so:</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs-extra&#39;</span><span class="p">);</span>

<span class="nx">helpers</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../app&#39;</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">inDir</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;./tmp&#39;</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dir</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// `dir` is the resolved target directory (or `path.join( __dirname, &#39;./tmp&#39;)` in this example)</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">copySync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../templates/common&#39;</span><span class="p">),</span> <span class="nx">dir</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">withPrompt</span><span class="p">({</span> <span class="nx">coffee</span><span class="o">:</span> <span class="kc">false</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// assert something</span>
  <span class="p">});</span>
</code></pre></div>
<p>You can also perform asynchronous task in your callback:</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs-extra&#39;</span><span class="p">);</span>

<span class="nx">helpers</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../app&#39;</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">inDir</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;./tmp&#39;</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dir</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">done</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">async</span><span class="p">();</span> <span class="c1">// `this` is the RunContext object.</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../templates/common&#39;</span><span class="p">),</span> <span class="nx">dir</span><span class="p">,</span> <span class="nx">done</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">withPrompt</span><span class="p">({</span> <span class="nx">coffee</span><span class="o">:</span> <span class="kc">false</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// assert something</span>
  <span class="p">});</span>
</code></pre></div>
<p>If your generator calls <code>composeWith()</code>, you may want to mock those dependent generators. Using <code>#withGenerators()</code>, pass in array of arrays that use <code>#createDummyGenerator()</code> as the first item and a namespace for the mocked generator as a second item:</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="kd">var</span> <span class="nx">deps</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">[</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">createDummyGenerator</span><span class="p">(),</span> <span class="s1">&#39;karma:app&#39;</span><span class="p">]</span>
<span class="p">];</span>
<span class="nx">helpers</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../app&#39;</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">inDir</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;./tmp&#39;</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">withGenerators</span><span class="p">(</span><span class="nx">deps</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="nx">done</span><span class="p">);</span>
</code></pre></div>
<h2>Assertions helpers</h2>

<p>Yeoman extends the <a href="http://nodejs.org/api/assert.html">native assert module</a> with generator related assertions helpers. You can see the full list of assertions helpers in our <a href="http://yeoman.github.io/generator/assert.html">API documentation</a>.</p>

<p>Require the assertion helpers:</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="kd">var</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;yeoman-generator&#39;</span><span class="p">).</span><span class="nx">assert</span><span class="p">;</span>
</code></pre></div>
<h3>Assert files exists</h3>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="nx">assert</span><span class="p">.</span><span class="nx">file</span><span class="p">([</span><span class="s1">&#39;Gruntfile.js&#39;</span><span class="p">,</span> <span class="s1">&#39;app/router.js&#39;</span><span class="p">,</span> <span class="s1">&#39;app/views/main.js&#39;</span><span class="p">]);</span>
</code></pre></div>
<p><code>assert.noFile()</code> assert the contrary.</p>

<h3>Assert a file content</h3>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="nx">assert</span><span class="p">.</span><span class="nx">fileContent</span><span class="p">(</span><span class="s1">&#39;controllers/user.js&#39;</span><span class="p">,</span> <span class="sr">/App\.UserController = Ember\.ObjectController\.extend/</span><span class="p">);</span>
</code></pre></div>
<p><code>assert.noFileContent()</code> assert the contrary.</p>

<h3>Others</h3>

<p>Refer to the <a href="http://yeoman.github.io/generator/helpers.html">API documentation</a> for other methods.</p>
